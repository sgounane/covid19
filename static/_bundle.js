!function(t){var e={};function a(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){const n=a(1);let r={};const i=document.getElementById("countries");i.addEventListener("change",(function(t){let e=t.target.options,a=t.target.selectedIndex,n=e[a].value,i=e[a].innerHTML;S.open("GET","https://api.covid19api.com/dayone/country/"+n),S.onreadystatechange=()=>{if(4==S.readyState&&200==S.status){let t=JSON.parse(S.response);m=t.length,r=function(t){v=2*Math.max.apply(Math,t.map((function(t){return t.Confirmed}))),h.value=v;const e=t.map(t=>`${new Date(t.Date).getDate()}/${new Date(t.Date).getMonth()+1}`),a=t.map(t=>v-t.Recovered-t.Deaths-t.Active),n=t.map(t=>t.Active),r=t.map(t=>t.Recovered),i=t.map(t=>t.Deaths);return{lbl:e,confirmed:a,active:n,recovered:r,deaths:i,population:v}}(t),L(g,i,r,0)}},S.send()}));const s=document.getElementById("gamaSlider"),o=document.getElementById("betaSlider"),d=document.getElementById("sigmaSlider"),u=document.getElementById("r0Label"),l=document.getElementById("gama"),c=document.getElementById("beta"),p=document.getElementById("sigma"),h=document.getElementById("population");h.addEventListener("input",w);document.getElementById("trainButton").addEventListener("click",(function(){var t=new Headers;t.append("Content-Type","application/json"),initVals=e={data:r,initVals:{gamma:Number.parseFloat(l.value),beta:Number.parseFloat(c.value),sigma:Number.parseFloat(p.value)}};var e=JSON.stringify(e);fetch("/train",{method:"POST",headers:t,body:e,redirect:"follow"}).then(t=>t.text()).then(t=>{console.log(t),params=JSON.parse(t),c.value=params.beta,l.value=params.gamma,p.value=params.sigma;var e=document.createEvent("Event");e.initEvent("input",!0,!0),c.dispatchEvent(e),l.dispatchEvent(e),p.dispatchEvent(e)}).catch(t=>console.log("error",t))})),l.value=s.value,c.value=o.value,p.value=d.value;let v=h.value,m=100;const b=document.getElementById("myCanvas");s.addEventListener("input",w),o.addEventListener("input",w),d.addEventListener("input",w),l.addEventListener("input",w),c.addEventListener("input",w),p.addEventListener("input",w);let g=function(t){return new Chart(t.getContext("2d"),{type:"line",data:{labels:[],datasets:[{label:"sucseptible",data:[],showLine:!1,pointRadius:1,borderColor:"rgba(0, 0, 200, 1)"},{label:"Active",data:[],pointRadius:1,showLine:!1,borderColor:"rgba(200, 200, 0, 1)"},{label:"Géris",data:[],pointRadius:1,showLine:!1,borderColor:"rgba(0, 200, 0, 1)"},{label:"Décés",data:[],pointRadius:1,showLine:!1,borderColor:"rgba(200, 0, 0, 1)"},{label:"S",borderWidth:1,data:[],pointRadius:0,borderColor:"rgba(0, 0, 200, 1)"},{label:"I",data:[],pointRadius:0,borderWidth:1,borderColor:"rgba(200, 200, 0, 1)"},{label:"R",data:[],pointRadius:0,borderWidth:1,borderColor:"rgba(0, 200, 0, 1)"},{label:"D",data:[],pointRadius:0,borderWidth:1,borderColor:"rgba(200, 0, 0, 1)"}]},options:{responsive:!0,legend:{position:"top"},maintainAspectRatio:!1,title:{display:!0,text:""}}})}(b),f=Number.parseFloat(s.value),y=Number.parseFloat(o.value),E=Number.parseFloat(d.value),_=Math.floor(1e3*y/(f+E))/1e3;function w(t){function e(t){return Object.assign({},t)}"gamaSlider"===t.target.getAttribute("id")?(f=Number.parseFloat(t.target.value),l.value=f):"betaSlider"===t.target.getAttribute("id")?(y=Number.parseFloat(t.target.value),c.value=y):"sigmaSlider"===t.target.getAttribute("id")?(E=Number.parseFloat(t.target.value),p.value=E):"gama"===t.target.getAttribute("id")?(f=Number.parseFloat(t.target.value),s.value=f):"beta"===t.target.getAttribute("id")?(y=Number.parseFloat(t.target.value),o.value=y):"sigma"===t.target.getAttribute("id")&&(E=Number.parseFloat(t.target.value),d.value=E),v=Number.parseInt(h.value),_=Math.floor(1e3*y/(f+E))/1e3,console.log(_),u.innerHTML=_;var a=function(t,a,r,i,s){var o=n(r,t,a,i),d=a,u=r,l=[],c=[];for(l.push(a),c.push(e(u));!((d+=i)>s);)o=o.step(),c.push(e(o.y)),l.push(d);return{t:l,y:c}}((function(t,e,a){t[0]=-y*e[0]*e[1]/v,t[1]=y*e[0]*e[1]/v-f*e[1]-E*e[1],t[2]=f*e[1],t[3]=E*e[1]}),0,[v-1,1,0,0],1,m);let r=a.t,i=a.y.map(t=>t[1]),b=a.y.map(t=>t[2]),w=a.y.map(t=>t[0]),S=a.y.map(t=>t[3]);L(g,"simulation SIR",{lbl:r,confirmed:w,active:i,recovered:b,deaths:S},1)}console.log(_),u.innerHTML=_;let S=new XMLHttpRequest;function L(t,e,a,n){switch(t.data.labels=a.lbl,n){case 0:t.data.datasets[0].data=a.confirmed,t.data.datasets[1].data=a.active,t.data.datasets[2].data=a.recovered,t.data.datasets[3].data=a.deaths,t.data.datasets[4].data=[],t.data.datasets[5].data=[],t.data.datasets[6].data=[],t.data.datasets[7].data=[];break;case 1:t.data.datasets[4].data=a.confirmed,t.data.datasets[5].data=a.active,t.data.datasets[6].data=a.recovered,t.data.datasets[7].data=a.deaths}t.options.title.text=e,t.update()}S.open("GET","https://api.covid19api.com/countries",!0),S.onreadystatechange=function(){if(S.readyState==XMLHttpRequest.DONE&&200==S.status){let t=JSON.parse(S.response);i.innerHTML="",t.sort((t,e)=>t.Country>e.Country?1:-1),t.forEach(t=>{if("EH"!=t.ISO2){let e=document.createElement("option");e.setAttribute("value",t.ISO2),e.textContent=t.Country,i.appendChild(e)}}),i.value="MA";let e=document.createEvent("Event");e.initEvent("change",!0,!0),i.dispatchEvent(e)}},S.send()},function(t,e,a){"use strict";t.exports=function(t,e,a,r){return new n(t,e,a,r)};var n=function(t,e,a,n){this.deriv=e,this.y=t,this.n=this.y.length,this.dt=n,this.t=a,this._ctor=this.y.constructor,this._w=new this._ctor(this.n),this._k1=new this._ctor(this.n),this._k2=new this._ctor(this.n),this._k3=new this._ctor(this.n),this._k4=new this._ctor(this.n)};n.prototype.step=function(){this.deriv(this._k1,this.y,this.t);for(var t=0;t<this.n;t++)this._w[t]=this.y[t]+this._k1[t]*this.dt*.5;this.deriv(this._k2,this._w,this.t+.5*this.dt);for(t=0;t<this.n;t++)this._w[t]=this.y[t]+this._k2[t]*this.dt*.5;this.deriv(this._k3,this._w,this.t+.5*this.dt);for(t=0;t<this.n;t++)this._w[t]=this.y[t]+this._k3[t]*this.dt;this.deriv(this._k4,this._w,this.t+this.dt);var e=this.dt/6;for(t=0;t<this.n;t++)this.y[t]+=e*(this._k1[t]+2*this._k2[t]+2*this._k3[t]+this._k4[t]);return this.t+=this.dt,this},n.prototype.steps=function(t){for(var e=0;e<t;e++)this.step();return this}}]);